<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>–ê–Ω–∞–ª–∏—Ç–∏–∫–∞ –≤–∞–∫–∞–Ω—Å–∏–π - –ü—É–ª–∫–æ–≤–æ</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
  <style>
    body { font-family: -apple-system, BlinkMacSystemFont, Segoe UI, Roboto, sans-serif; margin: 24px; }
    .row { display: grid; grid-template-columns: 1fr 1fr; gap: 24px; }
    .card { border: 1px solid #e5e7eb; border-radius: 8px; padding: 16px; }
    h1 { margin: 0 0 12px; }
    .meta { color: #6b7280; margin-bottom: 16px; }
    @media (max-width: 900px) { .row { grid-template-columns: 1fr; } }
    .controls { margin-bottom: 16px; display: flex; gap: 8px; flex-wrap: wrap; }
    input, button, select { padding: 8px 10px; }
  </style>
</head>
<body>
  <h1>–ê–Ω–∞–ª–∏—Ç–∏–∫–∞ –≤–∞–∫–∞–Ω—Å–∏–π</h1>
  <div class="meta" style="margin-bottom: 16px; color: #000000; font-weight: bold;">üìç –°–∞–Ω–∫—Ç-–ü–µ—Ç–µ—Ä–±—É—Ä–≥</div>
  <div id="vacancyStats" class="meta" style="margin-bottom: 16px; color: #000000; font-weight: bold; font-size: 14px;"></div>
  <div class="controls">
    <input id="q" placeholder="query (e.g. python developer)" style="display: none;" />
    <select id="presets">
      <option value="">–í—ã–±–µ—Ä–∏—Ç–µ –≤–∞–∫–∞–Ω—Å–∏—é</option>
      <option value="–∫–æ–Ω—Ç—Ä–æ–ª–µ—Ä –∫–ø–ø">–ò–Ω—Å–ø–µ–∫—Ç–æ—Ä—ã-–∫–æ–Ω—Ç—Ä–æ–ª—ë—Ä—ã</option>
      <option value="–∏–Ω—Å–ø–µ–∫—Ç–æ—Ä –¥–æ—Å–º–æ—Ç—Ä">–ò–Ω—Å–ø–µ–∫—Ç–æ—Ä—ã –ø–æ –¥–æ—Å–º–æ—Ç—Ä—É</option>
      <option value="–∏–Ω—Å–ø–µ–∫—Ç–æ—Ä –ø–µ—Ä—Ä–æ–Ω">–ò–Ω—Å–ø–µ–∫—Ç–æ—Ä—ã –ø–µ—Ä—Ä–æ–Ω–Ω–æ–≥–æ –∫–æ–Ω—Ç—Ä–æ–ª—è</option>
      <option value="–≥–±—Ä, –æ—Ö—Ä–∞–Ω–∞">–ò–Ω—Å–ø–µ–∫—Ç–æ—Ä –ì–ë–†</option>
    </select>
    <button id="apply">–ù–∞–π—Ç–∏</button>
  </div>
  <div class="row">
    <div class="card">
      <h3>–ó–∞—Ä–ø–ª–∞—Ç–∞ vs –†–µ–π—Ç–∏–Ω–≥ —Ä–∞–±–æ—Ç–æ–¥–∞—Ç–µ–ª—è</h3>
      <canvas id="bubbleChart" height="140"></canvas>
    </div>
    <div class="card">
      <h3>–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∑–∞—Ä–ø–ª–∞—Ç</h3>
      <div id="salaryIcons" style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 12px; padding: 16px 0;"></div>
      <div id="salaryText"></div>
    </div>
  </div>
  <script>
    // Mock data for demonstration
    const mockData = {
      "–∫–æ–Ω—Ç—Ä–æ–ª–µ—Ä –∫–ø–ø": {
        count: 45,
        salaries: { min: 45000, median: 55000, avg: 58000, max: 75000 },
        items: [
          { salary_avg: 50000, employer_mark: 3.5, title: "–ö–æ–Ω—Ç—Ä–æ–ª—ë—Ä –ö–ü–ü", employer_name: "–ê—ç—Ä–æ–ø–æ—Ä—Ç –ü—É–ª–∫–æ–≤–æ –û–û–û –í–æ–∑–¥—É—à–Ω—ã–µ –≤–æ—Ä–æ—Ç–∞ —Å–µ–≤–µ—Ä–Ω–æ–π —Å—Ç–æ–ª–∏—Ü—ã" },
          { salary_avg: 55000, employer_mark: 4.2, title: "–ò–Ω—Å–ø–µ–∫—Ç–æ—Ä-–∫–æ–Ω—Ç—Ä–æ–ª—ë—Ä", employer_name: "–û–û–û –°–ë–ê" },
          { salary_avg: 48000, employer_mark: 3.8, title: "–ö–æ–Ω—Ç—Ä–æ–ª—ë—Ä", employer_name: "–ß–û–ü –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å" },
          { salary_avg: 60000, employer_mark: 4.5, title: "–°—Ç–∞—Ä—à–∏–π –∫–æ–Ω—Ç—Ä–æ–ª—ë—Ä", employer_name: "–ê—ç—Ä–æ–ø–æ—Ä—Ç –ü—É–ª–∫–æ–≤–æ –û–û–û –í–æ–∑–¥—É—à–Ω—ã–µ –≤–æ—Ä–æ—Ç–∞ —Å–µ–≤–µ—Ä–Ω–æ–π —Å—Ç–æ–ª–∏—Ü—ã" },
          { salary_avg: 52000, employer_mark: 3.2, title: "–ö–æ–Ω—Ç—Ä–æ–ª—ë—Ä –ö–ü–ü", employer_name: "–û–û–û –ê–≤–∏–∞–±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å" }
        ]
      },
      "–∏–Ω—Å–ø–µ–∫—Ç–æ—Ä –¥–æ—Å–º–æ—Ç—Ä": {
        count: 38,
        salaries: { min: 42000, median: 52000, avg: 54000, max: 68000 },
        items: [
          { salary_avg: 50000, employer_mark: 4.0, title: "–ò–Ω—Å–ø–µ–∫—Ç–æ—Ä –ø–æ –¥–æ—Å–º–æ—Ç—Ä—É", employer_name: "–ê—ç—Ä–æ–ø–æ—Ä—Ç –ü—É–ª–∫–æ–≤–æ –û–û–û –í–æ–∑–¥—É—à–Ω—ã–µ –≤–æ—Ä–æ—Ç–∞ —Å–µ–≤–µ—Ä–Ω–æ–π —Å—Ç–æ–ª–∏—Ü—ã" },
          { salary_avg: 48000, employer_mark: 3.6, title: "–ò–Ω—Å–ø–µ–∫—Ç–æ—Ä –¥–æ—Å–º–æ—Ç—Ä–∞", employer_name: "–û–û–û –ê–≤–∏–∞–±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å" },
          { salary_avg: 55000, employer_mark: 4.3, title: "–°—Ç–∞—Ä—à–∏–π –∏–Ω—Å–ø–µ–∫—Ç–æ—Ä", employer_name: "–ê—ç—Ä–æ–ø–æ—Ä—Ç –ü—É–ª–∫–æ–≤–æ –û–û–û –í–æ–∑–¥—É—à–Ω—ã–µ –≤–æ—Ä–æ—Ç–∞ —Å–µ–≤–µ—Ä–Ω–æ–π —Å—Ç–æ–ª–∏—Ü—ã" },
          { salary_avg: 45000, employer_mark: 3.4, title: "–ò–Ω—Å–ø–µ–∫—Ç–æ—Ä", employer_name: "–ß–û–ü –°–ø–µ—Ü–Ω–∞–∑" }
        ]
      },
      "–∏–Ω—Å–ø–µ–∫—Ç–æ—Ä –ø–µ—Ä—Ä–æ–Ω": {
        count: 32,
        salaries: { min: 40000, median: 48000, avg: 50000, max: 62000 },
        items: [
          { salary_avg: 47000, employer_mark: 3.8, title: "–ò–Ω—Å–ø–µ–∫—Ç–æ—Ä –ø–µ—Ä—Ä–æ–Ω–Ω–æ–≥–æ –∫–æ–Ω—Ç—Ä–æ–ª—è", employer_name: "–ê—ç—Ä–æ–ø–æ—Ä—Ç –ü—É–ª–∫–æ–≤–æ –û–û–û –í–æ–∑–¥—É—à–Ω—ã–µ –≤–æ—Ä–æ—Ç–∞ —Å–µ–≤–µ—Ä–Ω–æ–π —Å—Ç–æ–ª–∏—Ü—ã" },
          { salary_avg: 45000, employer_mark: 3.5, title: "–ü–µ—Ä—Ä–æ–Ω–Ω—ã–π –∏–Ω—Å–ø–µ–∫—Ç–æ—Ä", employer_name: "–û–û–û –ê–≤–∏–∞–±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å" },
          { salary_avg: 52000, employer_mark: 4.1, title: "–°—Ç–∞—Ä—à–∏–π –∏–Ω—Å–ø–µ–∫—Ç–æ—Ä –ø–µ—Ä—Ä–æ–Ω–∞", employer_name: "–ê—ç—Ä–æ–ø–æ—Ä—Ç –ü—É–ª–∫–æ–≤–æ –û–û–û –í–æ–∑–¥—É—à–Ω—ã–µ –≤–æ—Ä–æ—Ç–∞ —Å–µ–≤–µ—Ä–Ω–æ–π —Å—Ç–æ–ª–∏—Ü—ã" }
        ]
      },
      "–≥–±—Ä, –æ—Ö—Ä–∞–Ω–∞": {
        count: 28,
        salaries: { min: 38000, median: 45000, avg: 47000, max: 58000 },
        items: [
          { salary_avg: 45000, employer_mark: 4.2, title: "–ò–Ω—Å–ø–µ–∫—Ç–æ—Ä –ì–ë–†", employer_name: "–ê—ç—Ä–æ–ø–æ—Ä—Ç –ü—É–ª–∫–æ–≤–æ –û–û–û –í–æ–∑–¥—É—à–Ω—ã–µ –≤–æ—Ä–æ—Ç–∞ —Å–µ–≤–µ—Ä–Ω–æ–π —Å—Ç–æ–ª–∏—Ü—ã" },
          { salary_avg: 42000, employer_mark: 3.7, title: "–û—Ö—Ä–∞–Ω–Ω–∏–∫ –ì–ë–†", employer_name: "–û–û–û –°–ë–ê" },
          { salary_avg: 48000, employer_mark: 4.0, title: "–°—Ç–∞—Ä—à–∏–π –∏–Ω—Å–ø–µ–∫—Ç–æ—Ä –ì–ë–†", employer_name: "–ê—ç—Ä–æ–ø–æ—Ä—Ç –ü—É–ª–∫–æ–≤–æ –û–û–û –í–æ–∑–¥—É—à–Ω—ã–µ –≤–æ—Ä–æ—Ç–∞ —Å–µ–≤–µ—Ä–Ω–æ–π —Å—Ç–æ–ª–∏—Ü—ã" }
        ]
      }
    };

    function getParams() {
      const sp = new URLSearchParams(window.location.search);
      const query = sp.get('query') || '–∫–æ–Ω—Ç—Ä–æ–ª–µ—Ä –∫–ø–ø';
      return { query };
    }

    function setControls({query}) {
      document.getElementById('q').value = query;
      // Set dropdown to match query
      const select = document.getElementById('presets');
      for (let option of select.options) {
        if (option.value === query) {
          select.value = query;
          break;
        }
      }
    }

    function applyFromControls() {
      const query = document.getElementById('q').value || '–∫–æ–Ω—Ç—Ä–æ–ª–µ—Ä –∫–ø–ø';
      const url = new URL(window.location.href);
      url.searchParams.set('query', query);
      window.location.href = url.toString();
    }

    function load() {
      const { query } = getParams();
      setControls({ query });
      
      // Get mock data for the query
      const data = mockData[query] || mockData["–∫–æ–Ω—Ç—Ä–æ–ª–µ—Ä –∫–ø–ø"];
      const s = data.salaries || {};
      
      // Display total vacancies found
      const vacancyStats = document.getElementById('vacancyStats');
      const totalVacancies = data.count || 0;
      vacancyStats.innerHTML = `üìä –í—Å–µ–≥–æ –Ω–∞–π–¥–µ–Ω–æ –≤–∞–∫–∞–Ω—Å–∏–π: ${totalVacancies.toLocaleString()}`;
      
      // Create salary stat icons
      const salaryIcons = document.getElementById('salaryIcons');
      salaryIcons.innerHTML = '';
      
      const stats = [
        { label: '–ú–∏–Ω', value: s.min, icon: 'üìâ', color: '#60a5fa' },
        { label: '–ú–µ–¥–∏–∞–Ω–∞', value: s.median, icon: 'üìä', color: '#60a5fa' },
        { label: '–°—Ä–µ–¥–Ω—è—è', value: s.avg, icon: 'üìà', color: '#60a5fa' },
        { label: '–ú–∞–∫—Å', value: s.max, icon: 'üöÄ', color: '#60a5fa' }
      ];
      
      stats.forEach(stat => {
        const iconDiv = document.createElement('div');
        iconDiv.style.cssText = `
          text-align: center;
          padding: 12px;
          border-radius: 8px;
          background: linear-gradient(135deg, ${stat.color}20, ${stat.color}10);
          border: 1px solid ${stat.color}30;
        `;
        iconDiv.innerHTML = `
          <div style="font-size: 24px; margin-bottom: 4px;">${stat.icon}</div>
          <div style="font-weight: bold; color: ${stat.color}; font-size: 14px;">${stat.label}</div>
          <div style="font-size: 16px; font-weight: bold; margin-top: 4px;">
            ${stat.value ? Math.round(stat.value).toLocaleString() + '‚ÇΩ' : 'N/A'}
          </div>
        `;
        salaryIcons.appendChild(iconDiv);
      });

      // Create bubble chart
      const items = data.items || [];
      const points = items.map(v => {
        const isPulkovo = (v.employer_name || '').toLowerCase().includes('–ø—É–ª–∫–æ–≤–æ') || 
                         (v.employer_name || '').toLowerCase().includes('–≤–æ–∑–¥—É—à–Ω—ã–µ –≤–æ—Ä–æ—Ç–∞');
        
        return {
          x: v.salary_avg,
          y: v.employer_mark,
          r: isPulkovo ? 12 : 6,
          title: v.title || '',
          employer: v.employer_name || '',
          isPulkovo: isPulkovo
        };
      });

      const bubbleCtx = document.getElementById('bubbleChart');
      const pulkovoPoints = points.filter(p => p.isPulkovo);
      const otherPoints = points.filter(p => !p.isPulkovo);
      
      new Chart(bubbleCtx, {
        type: 'bubble',
        data: { 
          datasets: [
            {
              label: '–î—Ä—É–≥–∏–µ –∫–æ–º–ø–∞–Ω–∏–∏',
              data: otherPoints,
              backgroundColor: 'rgba(59, 130, 246, 0.6)',
              borderColor: 'rgb(59, 130, 246)'
            },
            {
              label: '–ê—ç—Ä–æ–ø–æ—Ä—Ç –ü—É–ª–∫–æ–≤–æ',
              data: pulkovoPoints,
              backgroundColor: 'rgba(239, 68, 68, 0.8)',
              borderColor: 'rgb(239, 68, 68)'
            }
          ]
        },
        options: {
          plugins: {
            legend: { display: true },
            tooltip: {
              callbacks: {
                label: (ctx) => {
                  const v = ctx.raw;
                  return `${v.employer} ‚Äì ${v.title}: –∑–∞—Ä–ø–ª–∞—Ç–∞ ${Math.round(v.x)}‚ÇΩ | —Ä–µ–π—Ç–∏–Ω–≥ ${v.y.toFixed(1)}`;
                }
              }
            }
          },
          scales: {
            x: { title: { display: true, text: '–ó–∞—Ä–ø–ª–∞—Ç–∞ (—Ä—É–±.)' } },
            y: { title: { display: true, text: '–†–µ–π—Ç–∏–Ω–≥ —Ä–∞–±–æ—Ç–æ–¥–∞—Ç–µ–ª—è (1-5)' }, min: 1, max: 5 }
          }
        }
      });
    }

    document.getElementById('apply').addEventListener('click', applyFromControls);
    
    // Handle preset dropdown
    document.getElementById('presets').addEventListener('change', (e) => {
      const query = e.target.value;
      if (query) {
        document.getElementById('q').value = query;
        applyFromControls();
      }
    });
    
    load();
  </script>
</body>
</html>






